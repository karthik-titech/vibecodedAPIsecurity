# 🔒 VibeCoded API Security Framework

> **Enterprise-Grade Security for AI-Generated Applications**

A comprehensive security framework designed specifically for "vibe-coded" applications - those generated by AI tools that often lack proper security implementation. This framework provides **drop-in security protection** that addresses all common vulnerabilities found in AI-generated code.

## 🎯 **What Problem Does This Solve?**

AI-generated applications (vibe-coded apps) often have critical security gaps:

- ❌ **Hardcoded API keys** and secrets in source code
- ❌ **SQL injection vulnerabilities** from string concatenation
- ❌ **XSS attacks** from unencoded outputs
- ❌ **Weak authentication** with no brute-force protection
- ❌ **Missing input validation** and sanitization
- ❌ **No security headers** or CORS protection
- ❌ **Deprecated encryption** algorithms (MD5, etc.)
- ❌ **No monitoring** or incident response
- ❌ **Compliance violations** (PCI DSS, GDPR, etc.)
- ❌ **Performance issues** from unoptimized security

This framework **automatically fixes all these issues** with zero configuration required.

## 🚀 **Quick Start (5 Minutes)**

### 1. Install the Framework
```bash
npm install vibecoded-api-security
```

### 2. Add to Your Express App
```javascript
const express = require('express');
const { SecurityManager } = require('vibecoded-api-security');

const app = express();

// Initialize security framework
const securityManager = new SecurityManager({
  secrets: { vaultPath: '.vault' },
  auth: { secretKey: process.env.JWT_SECRET },
  validation: { strictMode: true }
});

// Apply comprehensive security protection
app.use(securityManager.createExpressMiddleware());

// Your existing routes are now automatically protected!
app.get('/api/users', (req, res) => {
  res.json({ users: [] });
});

app.listen(3000, () => {
  console.log('🔒 Secure app running on port 3000');
});
```

### 3. Run Security Scan
```bash
npx vibecoded-security-scan
```

That's it! Your app is now **enterprise-grade secure** with:
- ✅ **SQL injection protection**
- ✅ **XSS prevention**
- ✅ **Input validation**
- ✅ **Rate limiting**
- ✅ **Security headers**
- ✅ **Authentication & authorization**
- ✅ **Real-time monitoring**

## 📚 **Step-by-Step Guide**

### **Step 1: Understanding the Architecture**

The framework consists of **12 specialized security components**:

```
SecurityManager (Main Controller)
├── SecretManager (Credential Security)
├── SQLInjectionProtection (Database Security)
├── XSSProtection (Cross-Site Scripting Prevention)
├── AuthManager (Authentication & Authorization)
├── InputValidator (Input Validation & Sanitization)
├── CryptoManager (Cryptography & Encryption)
├── SecurityMonitor (Real-time Monitoring)
├── SecurityMiddleware (Express.js Middleware)
├── ComplianceManager (Regulatory Compliance)
├── IncidentResponseManager (Incident Response)
├── PerformanceSecurityManager (Performance Optimization)
└── SecurityScanner (Vulnerability Detection)
```

### **Step 2: Component Deep Dive**

#### **🔐 SecretManager - Prevents Hardcoded Credentials**

**Problem**: AI often hardcodes API keys like this:
```javascript
// ❌ BAD: Hardcoded secret
const stripeKey = 'sk_live_abc123def456';
```

**Solution**: SecretManager automatically detects and secures secrets:
```javascript
const { SecretManager } = require('vibecoded-api-security');

const secretManager = new SecretManager({ vaultPath: '.vault' });

// ✅ GOOD: Secure secret management
const stripeKey = await secretManager.getSecret('STRIPE_KEY');
```

**How it works**:
1. **Scans codebase** for hardcoded secrets
2. **Encrypts secrets** using AES-256-GCM
3. **Stores securely** in `.vault` directory
4. **Provides fallback** to environment variables

#### **🛡️ SQLInjectionProtection - Prevents Database Attacks**

**Problem**: AI often creates vulnerable queries:
```javascript
// ❌ BAD: SQL injection vulnerable
const query = `SELECT * FROM users WHERE name = '${userInput}'`;
```

**Solution**: SQLInjectionProtection provides safe queries:
```javascript
const { SQLInjectionProtection } = require('vibecoded-api-security');

const dbSecurity = new SQLInjectionProtection({
  type: 'postgresql',
  host: 'localhost',
  database: 'myapp'
});

// ✅ GOOD: Parameterized query
const result = await dbSecurity.executeQuery(
  'SELECT * FROM users WHERE name = $1',
  [userInput]
);
```

**How it works**:
1. **Validates queries** for dangerous patterns
2. **Uses parameterized queries** automatically
3. **Sanitizes inputs** before database operations
4. **Prevents UNION attacks** and other injection techniques

#### **🛡️ XSSProtection - Prevents Cross-Site Scripting**

**Problem**: AI often outputs user data without encoding:
```javascript
// ❌ BAD: XSS vulnerable
res.send(`<h1>Hello ${userInput}</h1>`);
```

**Solution**: XSSProtection automatically encodes outputs:
```javascript
const { XSSProtection } = require('vibecoded-api-security');

const xssProtection = new XSSProtection();

// ✅ GOOD: XSS protected
const safeOutput = xssProtection.encodeHTML(userInput);
res.send(`<h1>Hello ${safeOutput}</h1>`);
```

**How it works**:
1. **HTML encodes** special characters
2. **Sanitizes HTML** input
3. **Generates CSP headers** automatically
4. **Prevents script injection** attacks

#### **🔑 AuthManager - Secure Authentication**

**Problem**: AI often implements weak authentication:
```javascript
// ❌ BAD: Weak password handling
if (password === storedPassword) {
  // Login successful
}
```

**Solution**: AuthManager provides enterprise authentication:
```javascript
const { AuthManager } = require('vibecoded-api-security');

const authManager = new AuthManager({
  secretKey: process.env.JWT_SECRET,
  maxLoginAttempts: 5
});

// ✅ GOOD: Secure authentication
const result = await authManager.authenticate(email, password);
if (result.isValid) {
  const token = authManager.generateToken({ userId: result.user.id });
}
```

**How it works**:
1. **Bcrypt password hashing** with salt
2. **JWT token generation** and validation
3. **Brute-force protection** with account lockout
4. **Rate limiting** for login attempts
5. **Role-based access control** (RBAC)

#### **✅ InputValidator - Comprehensive Validation**

**Problem**: AI often skips input validation:
```javascript
// ❌ BAD: No validation
app.post('/api/users', (req, res) => {
  const { email, password } = req.body;
  // Use data directly without validation
});
```

**Solution**: InputValidator provides comprehensive validation:
```javascript
const { InputValidator } = require('vibecoded-api-security');

const validator = new InputValidator();

// ✅ GOOD: Comprehensive validation
const validation = validator.validate(req.body, validator.schemas.userRegistration);
if (!validation.isValid) {
  return res.status(400).json({ errors: validation.errors });
}
```

**How it works**:
1. **Schema-based validation** using Joi
2. **Input sanitization** and cleaning
3. **File upload validation** with type checking
4. **Custom validation rules** for business logic

#### **🔐 CryptoManager - Advanced Cryptography**

**Problem**: AI often uses deprecated algorithms:
```javascript
// ❌ BAD: Weak encryption
const hash = crypto.createHash('md5').update(password).digest('hex');
```

**Solution**: CryptoManager provides modern cryptography:
```javascript
const { CryptoManager } = require('vibecoded-api-security');

const cryptoManager = new CryptoManager();

// ✅ GOOD: Modern cryptography
const encrypted = cryptoManager.encrypt(data, key);
const hashed = cryptoManager.hashPassword(password);
```

**How it works**:
1. **AES-256-GCM encryption** for data at rest
2. **PBKDF2 password hashing** with 100,000+ iterations
3. **RSA/EC key generation** for digital signatures
4. **Secure random generation** for tokens and keys

#### **📊 SecurityMonitor - Real-time Monitoring**

**Problem**: AI-generated apps have no security monitoring:
```javascript
// ❌ BAD: No monitoring
app.get('/api/admin', (req, res) => {
  // No logging or monitoring
});
```

**Solution**: SecurityMonitor provides comprehensive monitoring:
```javascript
const { SecurityMonitor } = require('vibecoded-api-security');

const securityMonitor = new SecurityMonitor({
  logFile: 'security-events.log',
  alertThresholds: {
    failedLogins: 5,
    suspiciousRequests: 10
  }
});

// ✅ GOOD: Comprehensive monitoring
await securityMonitor.logSecurityEvent('ADMIN_ACCESS', {
  userId: req.user.id,
  ip: req.ip,
  action: 'admin_panel_access'
});
```

**How it works**:
1. **Real-time event logging** with severity levels
2. **Threat detection** and pattern recognition
3. **Alert notifications** via email, Slack, webhook
4. **Security statistics** and reporting

#### **🛡️ SecurityMiddleware - Express.js Protection**

**Problem**: AI-generated apps lack security headers:
```javascript
// ❌ BAD: No security headers
app.get('/', (req, res) => {
  res.send('Hello World');
});
```

**Solution**: SecurityMiddleware provides comprehensive protection:
```javascript
const { SecurityMiddleware } = require('vibecoded-api-security');

const securityMiddleware = new SecurityMiddleware({
  rateLimit: { max: 100, windowMs: 15 * 60 * 1000 },
  cors: { origin: ['https://myapp.com'] },
  helmet: { contentSecurityPolicy: true }
});

// ✅ GOOD: Comprehensive protection
app.use(securityMiddleware.createMiddlewareStack());
```

**How it works**:
1. **Helmet security headers** (CSP, HSTS, etc.)
2. **Rate limiting** to prevent abuse
3. **CORS protection** for cross-origin requests
4. **Request size limiting** to prevent attacks
5. **Security monitoring** integration

#### **📋 ComplianceManager - Regulatory Compliance**

**Problem**: AI-generated apps ignore compliance requirements:
```javascript
// ❌ BAD: No compliance considerations
app.post('/api/payments', (req, res) => {
  // No PCI DSS compliance
});
```

**Solution**: ComplianceManager ensures regulatory compliance:
```javascript
const { ComplianceManager } = require('vibecoded-api-security');

const complianceManager = new ComplianceManager({
  standards: ['PCI_DSS', 'GDPR', 'SOC2']
});

// ✅ GOOD: Compliance automation
const auditResults = await complianceManager.runComplianceAudit();
console.log(`Compliance Score: ${auditResults.overallScore}%`);
```

**How it works**:
1. **PCI DSS 4.0 compliance** for payment processing
2. **GDPR compliance** for data protection
3. **SOC 2 compliance** for security controls
4. **HIPAA compliance** for healthcare data
5. **Automated auditing** and reporting

#### **🚨 IncidentResponseManager - Automated Response**

**Problem**: AI-generated apps have no incident response:
```javascript
// ❌ BAD: No incident handling
app.post('/api/login', (req, res) => {
  // No response to failed login attempts
});
```

**Solution**: IncidentResponseManager provides automated response:
```javascript
const { IncidentResponseManager } = require('vibecoded-api-security');

const incidentManager = new IncidentResponseManager({
  autoResponse: true,
  notifications: {
    email: 'admin@myapp.com',
    slack: 'https://hooks.slack.com/...'
  }
});

// ✅ GOOD: Automated incident response
const incident = await incidentManager.createIncident({
  type: 'BRUTE_FORCE',
  ipAddress: req.ip,
  description: 'Multiple failed login attempts'
});
```

**How it works**:
1. **Automated incident detection** and classification
2. **Real-time response actions** (IP blocking, rate limiting)
3. **Multi-channel notifications** (email, Slack, SMS)
4. **Incident escalation** procedures
5. **Attack pattern correlation**

#### **⚡ PerformanceSecurityManager - Performance Optimization**

**Problem**: Security operations can slow down applications:
```javascript
// ❌ BAD: Unoptimized security
const hash = await bcrypt.hash(password, 12); // Slow operation
```

**Solution**: PerformanceSecurityManager optimizes security operations:
```javascript
const { PerformanceSecurityManager } = require('vibecoded-api-security');

const perfManager = new PerformanceSecurityManager({
  enableCaching: true,
  enableConnectionPooling: true,
  enableParallelProcessing: true
});

// ✅ GOOD: Optimized security operations
const hash = await perfManager.optimizedHash(password);
const stats = perfManager.getPerformanceStats();
```

**How it works**:
1. **Intelligent caching** for repeated operations
2. **Connection pooling** for database operations
3. **Parallel processing** for batch operations
4. **Performance monitoring** and optimization
5. **Rate limiting optimization**

### **Step 3: Integration Examples**

#### **Basic Integration (Minimal Setup)**
```javascript
const express = require('express');
const { SecurityManager } = require('vibecoded-api-security');

const app = express();

// Initialize with minimal configuration
const securityManager = new SecurityManager({
  secrets: { vaultPath: '.vault' },
  auth: { secretKey: process.env.JWT_SECRET }
});

// Apply all security protections
app.use(securityManager.createExpressMiddleware());

// Your routes are now automatically protected
app.get('/api/data', (req, res) => {
  res.json({ message: 'Secure data' });
});
```

#### **Advanced Integration (Full Control)**
```javascript
const express = require('express');
const {
  SecurityManager,
  SecurityMiddleware,
  SecurityMonitor,
  ComplianceManager,
  IncidentResponseManager,
  PerformanceSecurityManager
} = require('vibecoded-api-security');

const app = express();

// Initialize all components
const securityMiddleware = new SecurityMiddleware({
  rateLimit: { max: 100, windowMs: 15 * 60 * 1000 },
  cors: { origin: ['https://myapp.com'] }
});

const securityMonitor = new SecurityMonitor({
  logFile: 'security-events.log',
  alertThresholds: { failedLogins: 5 }
});

const complianceManager = new ComplianceManager({
  standards: ['PCI_DSS', 'GDPR']
});

const incidentManager = new IncidentResponseManager({
  autoResponse: true
});

const perfManager = new PerformanceSecurityManager({
  enableCaching: true
});

// Apply comprehensive security
app.use(securityMiddleware.createMiddlewareStack());
app.use(securityMonitor.createMonitoringMiddleware());
app.use(complianceManager.createComplianceMiddleware());
app.use(incidentManager.createIncidentResponseMiddleware());
app.use(perfManager.createPerformanceMiddleware());

// Start monitoring
securityMonitor.startMonitoring();
```

### **Step 4: Security Scanning**

#### **Automated Vulnerability Detection**
```bash
# Run comprehensive security scan
npx vibecoded-security-scan

# Scan specific directory
npx vibecoded-security-scan --dir ./src

# Generate detailed report
npx vibecoded-security-scan --report security-report.json
```

The scanner automatically detects:
- 🔍 **Hardcoded secrets** and API keys
- 🔍 **SQL injection vulnerabilities**
- 🔍 **XSS vulnerabilities**
- 🔍 **Authentication weaknesses**
- 🔍 **Input validation gaps**
- 🔍 **Dependency vulnerabilities**
- 🔍 **Configuration issues**
- 🔍 **File permission problems**

### **Step 5: Monitoring and Maintenance**

#### **Real-time Security Dashboard**
```javascript
// Get security status
const status = securityManager.getSecurityStatus();
console.log('Security Score:', status.score);

// Get compliance status
const compliance = complianceManager.getComplianceStatus();
console.log('PCI DSS Score:', compliance.standards.PCI_DSS.score);

// Get incident statistics
const incidents = incidentManager.getIncidentStats();
console.log('Active Incidents:', incidents.active);

// Get performance metrics
const performance = perfManager.getPerformanceStats();
console.log('Cache Hit Rate:', performance.cache.hitRate);
```

#### **Security Endpoints**
```javascript
// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'healthy', security: 'enabled' });
});

// Security status
app.get('/security/status', (req, res) => {
  res.json(securityManager.getSecurityStatus());
});

// Compliance audit
app.get('/security/compliance', (req, res) => {
  res.json(complianceManager.getComplianceStatus());
});

// Incident dashboard
app.get('/security/incidents', (req, res) => {
  res.json(incidentManager.getIncidentStats());
});

// Performance metrics
app.get('/security/performance', (req, res) => {
  res.json(perfManager.getPerformanceStats());
});
```

## 🛠️ **Configuration Options**

### **Environment Variables**
```bash
# Required
JWT_SECRET=your-super-secret-jwt-key
ENCRYPTION_KEY=your-32-byte-encryption-key

# Optional
DB_HOST=localhost
DB_PORT=5432
DB_NAME=myapp
DB_USER=postgres
DB_PASSWORD=password

# Security
SECURITY_WEBHOOK_URL=https://hooks.slack.com/...
SECURITY_EMAIL=admin@myapp.com
SECURITY_SLACK_WEBHOOK=https://hooks.slack.com/...
```

### **Configuration Object**
```javascript
const securityManager = new SecurityManager({
  // Secret management
  secrets: {
    vaultPath: '.vault',
    encryptionKey: process.env.ENCRYPTION_KEY
  },
  
  // Database security
  database: {
    type: 'postgresql',
    host: process.env.DB_HOST,
    port: process.env.DB_PORT,
    database: process.env.DB_NAME,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD
  },
  
  // Authentication
  auth: {
    secretKey: process.env.JWT_SECRET,
    tokenExpiry: '24h',
    maxLoginAttempts: 5,
    lockoutDuration: 15 * 60 * 1000
  },
  
  // Input validation
  validation: {
    strictMode: true,
    maxInputLength: 10000,
    allowedFileTypes: ['jpg', 'jpeg', 'png', 'gif', 'pdf'],
    maxFileSize: 5 * 1024 * 1024
  },
  
  // Monitoring
  monitoring: {
    logFile: 'security-events.log',
    alertThresholds: {
      failedLogins: 5,
      suspiciousRequests: 10
    }
  },
  
  // Compliance
  compliance: {
    standards: ['PCI_DSS', 'GDPR', 'SOC2'],
    auditInterval: 24 * 60 * 60 * 1000
  },
  
  // Performance
  performance: {
    enableCaching: true,
    enableConnectionPooling: true,
    enableParallelProcessing: true
  }
});
```

## 📊 **Security Metrics**

The framework provides comprehensive security metrics:

### **Security Score (0-100)**
- **90-100**: Excellent security posture
- **80-89**: Good security with minor improvements needed
- **70-79**: Acceptable security with recommendations
- **Below 70**: Security improvements required

### **Compliance Scores**
- **PCI DSS**: Payment card industry compliance
- **GDPR**: Data protection compliance
- **SOC 2**: Security controls compliance
- **HIPAA**: Healthcare data compliance

### **Performance Metrics**
- **Response Time**: Average security operation response time
- **Cache Hit Rate**: Percentage of cached operations
- **Connection Pool**: Database connection utilization
- **Throughput**: Operations per second

## 🔧 **Troubleshooting**

### **Common Issues**

#### **1. "Secret not found" Error**
```bash
# Solution: Set environment variable
export STRIPE_KEY=sk_test_your_key_here
```

#### **2. "Database connection failed" Error**
```bash
# Solution: Check database configuration
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=myapp
export DB_USER=postgres
export DB_PASSWORD=password
```

#### **3. "Rate limit exceeded" Error**
```javascript
// Solution: Adjust rate limiting
const securityMiddleware = new SecurityMiddleware({
  rateLimit: {
    max: 1000, // Increase limit
    windowMs: 15 * 60 * 1000
  }
});
```

#### **4. "Compliance violation" Warning**
```javascript
// Solution: Run compliance audit
const auditResults = await complianceManager.runComplianceAudit();
console.log('Violations:', auditResults.violations);
```

### **Debug Mode**
```javascript
// Enable debug logging
const securityManager = new SecurityManager({
  debug: true,
  logLevel: 'debug'
});
```

## 📚 **API Reference**

### **SecurityManager**
```javascript
// Main security controller
const securityManager = new SecurityManager(options);

// Get security status
const status = securityManager.getSecurityStatus();

// Create Express middleware
const middleware = securityManager.createExpressMiddleware();

// Secure endpoint wrapper
const secureHandler = securityManager.secureEndpoint(handler, options);

// Security scan
const scanResults = await securityManager.securityScan(directory);
```

### **SecretManager**
```javascript
// Secure secret management
const secretManager = new SecretManager(options);

// Store secret
await secretManager.setSecret('API_KEY', 'secret-value');

// Retrieve secret
const secret = await secretManager.getSecret('API_KEY');

// Scan for hardcoded secrets
const results = await secretManager.scanForHardcodedSecrets(directory);
```

### **SQLInjectionProtection**
```javascript
// Database security
const dbSecurity = new SQLInjectionProtection(options);

// Execute safe query
const result = await dbSecurity.executeQuery(query, params);

// Validate query
dbSecurity.validateQuery(query);

// Build safe queries
const selectQuery = dbSecurity.buildSelectQuery(table, conditions);
```

### **XSSProtection**
```javascript
// XSS prevention
const xssProtection = new XSSProtection();

// Encode HTML
const safe = xssProtection.encodeHTML(userInput);

// Sanitize HTML
const clean = xssProtection.sanitizeHTML(htmlInput);

// Generate CSP header
const cspHeader = xssProtection.generateCSPHeader();
```

### **AuthManager**
```javascript
// Authentication & authorization
const authManager = new AuthManager(options);

// Hash password
const hash = await authManager.hashPassword(password);

// Verify password
const isValid = await authManager.verifyPassword(password, hash);

// Generate JWT token
const token = authManager.generateToken(payload);

// Verify token
const decoded = authManager.verifyToken(token);
```

### **InputValidator**
```javascript
// Input validation
const validator = new InputValidator();

// Validate data
const validation = validator.validate(data, schema);

// Sanitize string
const clean = validator.sanitizeString(input);

// Validate file
const fileValidation = validator.validateFile(file);
```

## 🤝 **Contributing**

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

### **Development Setup**
```bash
# Clone repository
git clone https://github.com/your-org/vibecoded-api-security.git

# Install dependencies
npm install

# Run tests
npm test

# Run security scan
npm run scan

# Build documentation
npm run docs
```

## 📄 **License**

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🆘 **Support**

### **Documentation**
- [API Reference](docs/API.md)
- [Configuration Guide](docs/CONFIGURATION.md)
- [Security Best Practices](docs/BEST_PRACTICES.md)
- [Troubleshooting Guide](docs/TROUBLESHOOTING.md)

### **Community**
- [GitHub Issues](https://github.com/your-org/vibecoded-api-security/issues)
- [Discussions](https://github.com/your-org/vibecoded-api-security/discussions)
- [Security Advisories](https://github.com/your-org/vibecoded-api-security/security/advisories)

### **Professional Support**
- **Email**: support@vibecoded-security.com
- **Slack**: [Join our community](https://slack.vibecoded-security.com)
- **Enterprise**: [Contact sales](https://vibecoded-security.com/enterprise)

## 🙏 **Acknowledgments**

- **OWASP** for security guidelines and best practices
- **Node.js Security Working Group** for security recommendations
- **Express.js** team for the excellent web framework
- **Joi** for robust validation schemas
- **Helmet** for security headers
- **bcrypt** for secure password hashing

---

**Made with ❤️ for the AI-generated application community**

Transform your vibe-coded app into an enterprise-grade secure application in minutes! 
